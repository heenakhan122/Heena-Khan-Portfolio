import { Link } from "wouter";
import { ArrowLeft, ExternalLink, Github } from "lucide-react";

export default function ModestFilterProject() {
  return (
    <div className="min-h-screen bg-terminal-bg text-terminal-white">
      {/* Navigation Header */}
      <nav className="fixed top-0 left-0 right-0 z-50 bg-terminal-bg/95 backdrop-blur-sm border-b border-terminal-green">
        <div className="flex items-center justify-between p-4">
          <Link href="/" className="flex items-center gap-2 text-terminal-green hover:text-terminal-white transition-colors" data-testid="link-back-home">
            <ArrowLeft size={20} />
            <span>Back to Portfolio</span>
          </Link>
          <div className="text-terminal-green text-sm">heena@stanford</div>
        </div>
      </nav>

      {/* Main Content */}
      <div className="pt-20 pb-16">
        <div className="max-w-6xl mx-auto px-8">
          
          {/* Project Header */}
          <div className="mb-12">
            <h1 className="text-4xl md:text-5xl font-bold text-terminal-green mb-4">
              ModestFilter <span className="text-terminal-green">&#123;</span>
            </h1>
            <p className="text-terminal-gray text-xl mb-6">
              Chrome Extension — A cross-site modesty filter for online shopping that helps users find suitable clothing without endless clicking
            </p>
            
            {/* Project Links */}
            <div className="flex gap-4 mb-8">
              <button 
                className="px-6 py-3 bg-terminal-green text-terminal-bg font-semibold rounded hover:bg-terminal-green/90 transition-colors flex items-center gap-2"
                data-testid="button-view-demo"
              >
                <ExternalLink size={18} />
                View Demo
              </button>
              <button 
                className="px-6 py-3 border border-terminal-green text-terminal-green font-semibold rounded hover:bg-terminal-green/10 transition-colors flex items-center gap-2"
                data-testid="button-view-code"
              >
                <Github size={18} />
                View Code
              </button>
            </div>
          </div>

          {/* Project Image */}
          <div className="mb-12">
            <div className="rounded border border-terminal-green overflow-hidden">
              <img 
                src="/modestfilter-preview.webp" 
                alt="ModestFilter Chrome Extension Interface"
                className="w-full h-96 object-cover"
                data-testid="img-project-preview"
              />
            </div>
          </div>

          {/* Project Content Grid */}
          <div className="grid md:grid-cols-2 gap-12">
            
            {/* Project Description */}
            <div className="space-y-6">
              <h2 className="text-2xl font-semibold text-terminal-green">Overview</h2>
              <div className="space-y-4 text-terminal-gray text-lg leading-relaxed">
                <p>
                  Shopping for modest clothing online means opening dozens of product pages only to find items that don't meet coverage preferences. I built ModestFilter to solve this by automatically filtering product grids across any shopping site based on personal modesty guidelines—so users see only relevant items from the start.
                </p>
              </div>
            </div>

            {/* Before/After Comparison */}
            <div className="md:col-span-2 space-y-6 my-12">
              <h3 className="text-2xl font-semibold text-terminal-green text-center">ModestFilter in Action</h3>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <div className="rounded border border-terminal-green/50 overflow-hidden">
                    <img 
                      src="/modestfilter-before.png" 
                      alt="Urban Outfitters product grid before applying ModestFilter - showing mix of modest and immodest clothing items"
                      className="w-full h-auto"
                      data-testid="img-before-filter"
                    />
                  </div>
                  <div className="text-center">
                    <h4 className="text-lg font-semibold text-terminal-green">Before</h4>
                    <p className="text-terminal-gray text-sm">Original product grid with mixed modesty levels</p>
                  </div>
                </div>
                <div className="space-y-4">
                  <div className="rounded border border-terminal-green overflow-hidden">
                    <img 
                      src="/modestfilter-after.png" 
                      alt="Urban Outfitters product grid after applying ModestFilter - showing only modest clothing options"
                      className="w-full h-auto"
                      data-testid="img-after-filter"
                    />
                  </div>
                  <div className="text-center">
                    <h4 className="text-lg font-semibold text-terminal-green">After</h4>
                    <p className="text-terminal-gray text-sm">Filtered results showing only modest alternatives</p>
                  </div>
                </div>
              </div>
              <div className="text-center max-w-4xl mx-auto">
                <p className="text-terminal-gray leading-relaxed">
                  <strong className="text-terminal-green">Urban Outfitters product grid comparison:</strong> ModestFilter automatically identifies and hides sleeveless tops, crop tops, and low-neckline items while preserving the original grid layout and browsing flow. The extension intelligently maintains the page structure and shopping experience while showing only clothing that meets modest coverage preferences.
                </p>
              </div>
            </div>

            {/* Resume Grid Layout */}
            <div className="grid md:grid-cols-2 gap-12">
              <div className="space-y-6">
              
                <h3 className="text-xl font-semibold text-terminal-green">The Technical Challenge</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  The core challenge was building a system that works reliably across 15+ different e-commerce platforms (Amazon, Target, H&M, Zara, etc.) despite completely inconsistent DOM structures, dynamic content loading, and varying data formats. Each site structures product information differently, uses different CSS frameworks, and loads content through different JavaScript patterns.
                </p>
              </div>

              <h3 className="text-xl font-semibold text-terminal-green">System Architecture</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  I architected this as a Chrome extension using Manifest V3 with a multi-layered filtering system that processes 200+ product images per page load with &lt;100ms average latency:
                </p>
              </div>
              
              <h4 className="text-lg font-semibold text-terminal-green">Chrome Extension Architecture</h4>
              <ul className="space-y-2 text-terminal-gray">
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Service worker handles cross-origin requests and coordinates between components</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Content script analyzes product grids and applies filters in real-time</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Web worker processes images for visual analysis without blocking the main thread</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Popup interface for setting preferences (stored in Chrome sync storage)</span>
                </li>
              </ul>

              <h4 className="text-lg font-semibold text-terminal-green">Cross-Site DOM Parsing</h4>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  Built resilient selectors using MutationObserver and fallback strategies to handle dynamic e-commerce sites. The system tries multiple extraction paths: accessible attributes, common title selectors, img[alt] text, and structured data parsing. When primary methods fail, it fetches the full product page to parse JSON-LD structured data and detailed specifications.
                </p>
              </div>

              <h4 className="text-lg font-semibold text-terminal-green">Concurrent Image Processing</h4>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  Architected Web Worker pipeline with bounded concurrency (max 3 workers) to analyze product images without blocking the UI. Each worker downsamples images and analyzes specific regions (arms, neckline, torso) to estimate coverage attributes. The system uses IntersectionObserver to only process visible items, maintaining smooth scrolling performance.
                </p>
              </div>
            </div>

            {/* Technical Details */}
            <div className="space-y-6">
              <h2 className="text-2xl font-semibold text-terminal-green">Technical Implementation Highlights</h2>
              
              <h3 className="text-xl font-semibold text-terminal-green">Two-Stage Classification System</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  <strong className="text-terminal-green">Text Analysis (Primary):</strong> Extracts product information using multiple DOM parsing strategies, feeding regex vocabularies for sleeves, neckline, hem, fit, and modesty cues. Handles malformed JSON-LD data and inconsistent product descriptions across sites.
                </p>
                <p>
                  <strong className="text-terminal-green">Computer Vision (Secondary):</strong> When text analysis confidence is low, the Web Worker analyzes skin-tone pixels across key regions to classify sleeve length, neckline depth, and crop likelihood. All processing happens on-device for privacy.
                </p>
              </div>

              <h3 className="text-xl font-semibold text-terminal-green">Algorithm Optimization</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  The decision engine combines weak signals from both text and vision analysis, achieving 97% recall (rarely misses items that should be hidden) and 80% precision (most hidden items truly need filtering). Built custom conflict resolution when text and vision signals disagree, with protective bias toward keeping borderline modest items visible.
                </p>
              </div>

              <h3 className="text-xl font-semibold text-terminal-green">Performance & Memory Management</h3>
              <ul className="space-y-2 text-terminal-gray">
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Caps concurrent image processing to prevent memory spikes on large product grids</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Implements LRU cache for parsed product metadata to avoid re-processing</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Uses efficient CSS class-based hiding (.mf-hidden) to preserve grid layout integrity</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Handles memory cleanup when users navigate between category pages</span>
                </li>
              </ul>

              <h3 className="text-xl font-semibold text-terminal-green">Scale and Reliability Considerations</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  <strong className="text-terminal-green">Cross-Site Compatibility:</strong> The system handles site layout changes through fallback selector strategies and graceful degradation. When primary selectors break, it automatically attempts alternative parsing methods before falling back to text-only analysis.
                </p>
              </div>
              
              <h4 className="text-lg font-semibold text-terminal-green">Edge Case Handling</h4>
              <ul className="space-y-2 text-terminal-gray">
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Manages styled product photos with multiple layers through confidence scoring</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Handles international sites with different languages in product descriptions</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Processes dynamic loading (infinite scroll, lazy loading) through mutation observers</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Deals with sites that load images asynchronously or use placeholder images</span>
                </li>
              </ul>
              
              <h4 className="text-lg font-semibold text-terminal-green">Error Recovery</h4>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  Built comprehensive error logging that catches 99.8% of parsing failures, allowing the system to adapt to new site structures. Failed analyses default to showing items rather than hiding them incorrectly.
                </p>
              </div>

              <h3 className="text-xl font-semibold text-terminal-green">Results and Performance</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  <strong className="text-terminal-green">Classification Accuracy:</strong> Using a labeled dataset of 252 items across multiple retailers and categories:
                </p>
              </div>
              <ul className="space-y-2 text-terminal-gray">
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span><strong>97% recall:</strong> Correctly identifies and hides almost all non-modest items</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span><strong>80% precision:</strong> Most hidden items truly should be filtered out</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span><strong>~56% average reduction</strong> in displayed items per category page</span>
                </li>
              </ul>
              
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  <strong className="text-terminal-green">Technical Performance:</strong>
                </p>
              </div>
              <ul className="space-y-2 text-terminal-gray">
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Processes 200+ product images per page with &lt;100ms average latency per image</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Memory usage stays under 50MB even on large category pages (100+ products)</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Zero performance impact on page scrolling or navigation</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Handles concurrent analysis across multiple browser tabs without conflicts</span>
                </li>
              </ul>

              <h3 className="text-xl font-semibold text-terminal-green">Key Engineering Challenges Solved</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  <strong className="text-terminal-green">Inconsistent Data Sources:</strong> E-commerce sites structure product information completely differently. I solved this with multiple extraction strategies and robust fallback methods, ensuring high reliability across diverse platforms.
                </p>
                <p>
                  <strong className="text-terminal-green">Performance vs. Accuracy Tradeoff:</strong> Real-time analysis across dozens of products could slow down browsing. I optimized by implementing bounded concurrency, viewport-focused processing, and intelligent caching of analysis results.
                </p>
                <p>
                  <strong className="text-terminal-green">Privacy-First Architecture:</strong> All image processing and user preferences stay local to the browser. No data is transmitted to external servers, requiring careful optimization of on-device processing algorithms.
                </p>
              </div>

              <h3 className="text-xl font-semibold text-terminal-green">What This Project Demonstrates</h3>
              <div className="space-y-4 text-terminal-gray leading-relaxed">
                <p>
                  This project showcases several key areas relevant to large-scale systems:
                </p>
              </div>
              <ul className="space-y-2 text-terminal-gray">
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Cross-platform compatibility handling inconsistent data sources</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Real-time processing with strict performance constraints</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Computer vision integration with traditional text processing</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Browser extension architecture navigating security restrictions</span>
                </li>
                <li className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-terminal-green rounded-full mt-2"></div>
                  <span>Privacy-first design requiring local processing optimization</span>
                </li>
              </ul>
              <div className="space-y-4 text-terminal-gray leading-relaxed mt-4">
                <p>
                  The combination of algorithmic complexity (text + vision classification), systems challenges (cross-site compatibility), and performance optimization (real-time processing) makes this a comprehensive demonstration of full-stack engineering skills.
                </p>
              </div>

              <div className="flex flex-wrap gap-3 mt-6">
                <strong className="text-terminal-green w-full mb-2">Technologies:</strong>
                {['JavaScript', 'Chrome Extension APIs', 'Web Workers', 'Computer Vision', 'DOM Manipulation', 'Performance Optimization'].map((tech) => (
                  <span key={tech} className="px-3 py-1.5 bg-terminal-green/20 text-terminal-green border border-terminal-green/30 rounded-full text-sm">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="mt-12 text-terminal-green text-2xl">&#125;</div>
        </div>
      </div>
    </div>
  );
}